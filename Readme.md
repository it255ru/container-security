# Hardened Nginx Docker Image

(RU) Hardened образ Nginx, собранный из исходного кода с фокусом на безопасность и минимализм.
(EN) A security-hardened Nginx container built from source with minimal attack surface.

## Dockerfile Security Scan with SBOM

GitHub Actions workflow для автоматического сканирования безопасности Docker образов с генерацией Software Bill of Materials (SBOM).

## Назначение

Этот workflow автоматически анализирует Dockerfile и собранные образы на предмет:
- **Уязвимостей безопасности** в базовых образах и зависимостях
- **Best practices** для Dockerfile
- **Лицензионной совместимости** компонентов
- **Составления SBOM** (Software Bill of Materials) для полной прозрачности

## Быстрый старт

1. **Добавьте workflow** в ваш репозиторий в `.github/workflows/docker-security.yml`
2. **Настройте триггеры** под ваши нужды
3. **Убедитесь что Dockerfile** находится в корне репозитория
4. **Запустите workflow** - результаты появятся в Issues

## Просмотр результатов

После выполнения workflow проверьте:
1. **Issues** - основные проблемы и сводка
2. **Actions artifacts** - полные отчеты и SBOM
3. **PR comments** - результаты проверки для code review

## Конфигурация

Workflow не требует дополнительной конфигурации, но можно настроить:
- Уровни серьезности для проверки
- Форматы отчетов
- Правила линтинга Hadolint
- Политики fail-on для разных типов проблем

## Триггеры запуска

Workflow автоматически запускается при:
- Push в ветку `main`
- Создании Pull Request в ветку `main`
- Ручном запуске из раздела Actions

## Основные этапы анализа

### 1. **Статический анализ Dockerfile**
- **Hadolint** - линтер для проверки best practices
- **Кастомные проверки** - non-root пользователь, безопасные инструкции

### 2. **Сборка образа**
- Попытка сборки Docker образа
- Проверка наличия `.dockerignore`
- Создание тегов с SHA коммита

### 3. **Генерация SBOM**
- **Syft** - создание полного списка компонентов в формате CycloneDX
- Анализ всех пакетов Alpine Linux и их зависимостей
- Добавление кастомной информации о скомпилированных компонентах

### 4. **Сканирование уязвимостей**
- **Trivy** - сканирование собранного образа на CVE
- **Grype** - сканирование SBOM на уязвимости
- Фокус на HIGH и CRITICAL уязвимостях

### 5. **Создание отчетов**
- Детальный анализ в формате Markdown
- Автоматическое создание/обновление Issue
- Прикрепление полных отчетов как комментариев к Issue
- Сохранение артефактов (SBOM, образы, логи)

## Результаты работы

### Создаваемые артефакты:
- `sbom-cyclonedx-{sha}` - SBOM в формате CycloneDX
- `docker-image-{sha}` - Собранный Docker образ
- `security-reports-{sha}` - Полные отчеты сканирования

### Автоматические уведомления:
- **Issue** создается при обнаружении проблем
- **Комментарии в PR** при проверке pull request
- **Вложения в Issue** с полными отчетами (SBOM, результаты сканирований)

## Используемые инструменты

| Инструмент | Назначение |
|------------|------------|
| **Hadolint** | Линтинг Dockerfile |
| **Syft** | Генерация SBOM |
| **Trivy** | Сканирование образов на уязвимости |
| **Grype** | Сканирование SBOM на уязвимости |
| **Docker Buildx** | Сборка образов |

## Мониторинг и отчетность

### Уровни серьезности проблем:
- **CRITICAL** - Критические проблемы безопасности
- **HIGH** - Высокорисковые уязвимости  
- **WARNING** - Нарушения best practices

### Примеры обнаруживаемых проблем:
- Использование root пользователя
- Устаревшие базовые образы
- Известные CVE в зависимостях
- Небезопасные инструкции (curl | bash)
- Отсутствие .dockerignore


---

*Автоматизированная система безопасности контейнеров | [Подробнее о SBOM](https://cyclonedx.org/)*
